name: Secret Scanning

on:
  push:
    branches:
      - '*'

jobs:
  secret_scan:
    name: Scan for Git Secrets
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2
      
    - name: Download git-secrets
      run: |
        git clone https://github.com/awslabs/git-secrets.git /tmp/git-secrets
        cd /tmp/git-secrets
        sudo make install PREFIX=/home/ubuntu
      
    - name: Add git secrets patterns for AWS provider
      run: |
        /home/ubuntu/bin/git-secrets --register-aws --global

    - name: Scan for Git Secrets
      run: /home/ubuntu/bin/git-secrets --scan

    - name: Revert changes
      run: |
        cd $GITHUB_WORKSPACE
        git clean -fdX
